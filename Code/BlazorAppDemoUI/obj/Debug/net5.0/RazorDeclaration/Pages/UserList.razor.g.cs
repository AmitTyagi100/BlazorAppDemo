// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace BlazorAppDemo.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using BlazorAppDemo;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\_Imports.razor"
using BlazorPro.Spinkit;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using BlazorAppDemo.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using BlazorAppDemo.ApiConnect;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using BlazorDemoRazorLibrary;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using BlazorAppDemo.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using CrossCuttingEntities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
using BlazorAppDemo.Data;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/userlist")]
    public partial class UserList : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 124 "E:\Code\GitHubRepos\AmitTyagi100\BlazorAppDemo\Code\BlazorAppDemoUI\Pages\UserList.razor"
       

	//public User user { get; set; }
	//public List<User> users { get; set; }

	//public List<User> filteredUserList { get; set; }

	public string SelectedDeptEdit { get; set; }

	public UserInfo userInfo { get; set; }
	public List<UserInfo> usersInfo { get; set; }

	public List<UserInfo> filteredUserInfoList { get; set; }

	public bool IsVisible { get; set; }
	public bool Result { get; set; }
	public string RecordName { get; set; }

	bool isLoading = true;
	public bool IsGridViewFiltered { get; set; }



	public short SelectedDepartmentID { get; set; }
	public string SelectedDepartmentName { get; set; }

	ElementReference firstNameTextBox;

	protected override void OnInitialized()
	{
		Console.WriteLine("Users - OnInitialized");
		base.OnInitialized();
	}

	protected override async Task OnInitializedAsync()
	{
		Console.WriteLine("Users - OnInitializedAsync");

		userInfo = new UserInfo();
		usersInfo = new List<UserInfo>();


		await base.OnInitializedAsync();
	}

	protected override void OnParametersSet()
	{
		Console.WriteLine("Users - OnParametersSet");
		base.OnParametersSet();
	}

	protected override async Task OnParametersSetAsync()
	{
		Console.WriteLine("Users - OnParametersSetAsync");
		await base.OnParametersSetAsync();
	}

	protected override bool ShouldRender()
	{
		base.ShouldRender();
		Console.WriteLine("Users - ShouldRender");

		return true;
	}

	protected override void OnAfterRender(bool firstRender)
	{
		Console.WriteLine("Users - OnAfterRender - firstRender = " + firstRender);
		base.OnAfterRender(firstRender);
	}

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		Console.WriteLine("Users - OnAfterRenderAsync - firstRender = " + firstRender);

		if (firstRender)
		{
			await LoadUsers();

			isLoading = false;
			StateHasChanged();
		}

		await base.OnAfterRenderAsync(firstRender);
	}

	public void Dispose()
	{
		Console.WriteLine("Users - Dispose");
	}

	private string GetIsActiveText(bool isActive)
	{

		if (isActive)
			return "True";
		else
			return "Flase";

	}

	private async Task LoadUsers()
	{
		await Task.Delay(500);

		usersInfo = filteredUserInfoList = await userAPIService.GetAllAsync("UserInfo");

		if (usersInfo == null)
		{
			RefreshTokenRequest refreshTokenRequest = new RefreshTokenRequest();
			refreshTokenRequest.AccessToken = await localStorageService.GetItemAsync<string>("accessToken");
			refreshTokenRequest.RefreshToken = await localStorageService.GetItemAsync<string>("refreshToken");

			var user1 = await userService.RefreshTokenAsync(refreshTokenRequest);
			await localStorageService.SetItemAsync("accessToken", user1.AccessToken);

			usersInfo = filteredUserInfoList = await userAPIService.GetAllAsync("UserInfo");
		}


		StateHasChanged();
	}






	private async Task SaveUser()
	{
		userInfo.DeptId = SelectedDepartmentID;

		if (userInfo.UserDepartment != null)
		{
			userInfo.UserDepartment = new Department() { DeptId = SelectedDepartmentID, DeptName = "-" };

		}
		else
		{
			userInfo.UserDepartment.DeptId = SelectedDepartmentID;
			userInfo.UserDepartment.DeptName = "-";
		}

		//if (user.UserId == 0)
		//	await userAPIService.SaveAsync("authors/CreateAuthor", user);
		//else
		//	await userAPIService.UpdateAsync("authors/UpdateAuthor", author.AuthorId, author);


		await userAPIService.UpdateAsync("UserInfo", userInfo.UserId.GetValueOrDefault(), userInfo);

		await LoadUsers();

		Result = true;
		IsVisible = true;

		var firstName = userInfo.FirstName;
		var lastName = userInfo.LastName;

		RecordName = firstName + " " + lastName;

		userInfo = new UserInfo();

		//await JSRuntime.InvokeVoidAsync("saveMessage", firstName, lastName);
		await JSRuntime.InvokeVoidAsync("setFocusOnElement", firstNameTextBox);
	}

	private async Task DeleteUser(int userId)
	{
		await userAPIService.DeleteAsync("Users", userId);
		await LoadUsers();

		//throw new Exception("DeleteAuthor");
	}

	private void EditUser(UserInfo argUserInfo)
	{
		userInfo = argUserInfo;

		SelectedDeptEdit = userInfo.UserDepartment == null ? "" : userInfo.UserDepartment.DeptId.ToString();

	}

	private void OnSelectDepartmentChange(ChangeEventArgs changeEventArgs)
	{
		SelectedDepartmentID = Convert.ToInt16(changeEventArgs.Value);
		SelectedDepartmentName = changeEventArgs.ToString();




	}


	private void OnUserSearchTextChanged(ChangeEventArgs changeEventArgs, string columnTitle)
	{
		string searchText = changeEventArgs.Value.ToString();
		IsGridViewFiltered = true;

		switch (columnTitle)
		{

			case "FirstName":
				filteredUserInfoList = usersInfo.Where(U => U.FirstName.ToLower().Contains(searchText)).ToList();
				break;
			case "LastName":
				filteredUserInfoList = usersInfo.Where(U => U.LastName.ToLower().Contains(searchText)).ToList();
				break;
			case "Department":
				filteredUserInfoList = usersInfo.Where(U => U.UserDepartment.DeptName.ToLower().Contains(searchText)).ToList();
				break;
			case "EmailAddress":
				filteredUserInfoList = usersInfo.Where(U => U.EmailAddress.ToLower().Contains(searchText)).ToList();
				break;
			case "IsActive":
				filteredUserInfoList = usersInfo.Where(U => U.IsActive == ConvertSearchTextToBool(searchText)).ToList();
				break;
			default:
				Console.WriteLine("Default case");
				break;
		}
	}
	private bool? ConvertSearchTextToBool(string searchText) {

		bool result = false;
		if (searchText.ToLower() == "1" || searchText.ToLower() == "yes")
		{ searchText = "true"; }


		if (bool.TryParse(searchText,out result)) {
			return result;
		}
		return result;


	}


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILocalStorageService localStorageService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IUserData userService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IAPIServices<UserInfo> userAPIService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<App> Localizer { get; set; }
    }
}
#pragma warning restore 1591
